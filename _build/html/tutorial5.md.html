<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Mapeo objeto/relacional &mdash; Desarrollo con Java</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Desarrollo con Java" href="index.html" />
    <link rel="next" title="7. Uso de JSTL" href="tutorial6.md.html" />
    <link rel="prev" title="4. Modelo del Dominio" href="tutorial4.md.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial6.md.html" title="7. Uso de JSTL"
             accesskey="N">siguiente</a></li>
        <li class="right" >
          <a href="tutorial4.md.html" title="4. Modelo del Dominio"
             accesskey="P">anterior</a> |</li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mapeo-objeto-relacional">
<h1>6. Mapeo objeto/relacional<a class="headerlink" href="#mapeo-objeto-relacional" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Este tutorial muestra la forma de desarrollar una aplicación que utilice
<strong>modelo del dominio</strong> como patrón de diseño de la capa de dominio, y
<strong>mapeador objeto/relacional</strong> para la capa de acceso a datos.</p>
<div class="section" id="capa-de-logica-del-dominio">
<h2>6.1. Capa de lógica del dominio<a class="headerlink" href="#capa-de-logica-del-dominio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para implementar la capa de lógica del dominio se utilizará la técnica
de <strong>modelo del dominio</strong> tal como el tutorial anterior. En este caso el
modelo agrupa toda la lógica del dominio, pero no se encarga del acceso
a datos.</p>
<p>La primer clase necesaria consiste en la entidad profesor
<strong>Profesor.java</strong> y residirá en el directorio
<strong>/tutorial5/src/domain/</strong>. Esta clase es la que contendría la lógica
del dominio.</p>
<div class="highlight-python"><div class="highlight"><pre>package domain;

public class Profesor {
  private int id;
  private String cedula;
  private String nombre;
  private String titulo;
  private String area;
  private String telefono;

  public Profesor () {};
  public void setId(int id) {this.id=id;}
  public void setCedula(String cedula) {this.cedula=cedula;}
  public void setNombre(String nombre) {this.nombre=nombre;}
  public void setTitulo(String titulo) throws Exception {
    if (titulo.toLowerCase().equals(&quot;bachiller&quot;) ||
        titulo.toLowerCase().equals(&quot;licenciado&quot;) ||
        titulo.toLowerCase().equals(&quot;master&quot;) ||
        titulo.toLowerCase().equals(&quot;doctor&quot;))
      this.titulo=titulo;
    else
      throw new Exception(&quot;Error en título de profesor&quot;);
  }
  public void setArea(String area) {this.area=area;}
  public void setTelefono(String telefono) {this.telefono=telefono;}
  public int getId() {return id;}
  public String getCedula() {return cedula;}
  public String getNombre() {return nombre;}
  public String getTitulo() {return titulo;}
  public String getArea() {return area;}
  public String getTelefono() {return telefono;}
}
</pre></div>
</div>
<div class="section" id="el-repositorio-de-datos">
<h3>6.1.1. El repositorio de datos<a class="headerlink" href="#el-repositorio-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para mantener almacenados y recuperar los diferentes objetos, se utiliza
el objeto llamado <strong>ProfesorRepository.java</strong> residente en el mismo
directorio <strong>/tutorial5/src/domain/</strong>. Sin embargo, este tipo de objeto
solamente es una interfase Java como se puede observar a continuación:</p>
<div class="highlight-python"><div class="highlight"><pre>package domain;
import java.util.Map;
import java.util.HashMap;
import java.util.Collection;

public interface ProfesorRepository {
  public boolean insertProfesor(Profesor prof);
  public boolean deleteProfesor(Profesor prof);
  public Profesor findProfesor(int id);
  public boolean updateProfesor(Profesor prof);
  public Collection findAllProfesor();
}
</pre></div>
</div>
</div>
<div class="section" id="la-fabrica-de-objetos">
<h3>6.1.2. La fábrica de objetos<a class="headerlink" href="#la-fabrica-de-objetos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Generalmente cuando se elabora un modelo del dominio es importante crear
una clase aparte que se encargue de crear instancias de objetos. En este
caso se utilizará la clase <strong>ProfesorFactory.java</strong> y se ubicará en el
mismo directorio <strong>/tutorial5/src/domain/</strong></p>
<div class="highlight-python"><div class="highlight"><pre>package domain;

public class ProfesorFactory {
  public Profesor Create(int id,String cedula,String nombre,
                  String titulo,String area,String telefono) {
    try {
      Profesor prof = new Profesor();
      prof.setId(id);
      prof.setCedula(cedula);
      prof.setNombre(nombre);
      prof.setTitulo(titulo);
      prof.setArea(area);
      prof.setTelefono(telefono);
      return prof;
    } catch (Exception e) {
      return null;
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="compilando-la-capa-del-dominio">
<h3>6.1.3. Compilando la capa del dominio<a class="headerlink" href="#compilando-la-capa-del-dominio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se puede realizar la compilación de estas tres clases en forma separada
del resto del código. La siguiente instrucción para ejecutar la
compilación puede estar definida en un archivo
<strong>compileDomainLayer.bat</strong> residente en el directorio <strong>/tutorial5/</strong>
(todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -d root/WEB-INF/classes src/domain/Profesor.java
  src/domain/ProfesorFactory.java src/domain/ProfesorRepository.java
</pre></div>
</div>
<p>Nota: La versión del JDK debe ser superior a 6.0</p>
</div>
</div>
<div class="section" id="capa-de-presentacion">
<h2>6.2. Capa de presentación<a class="headerlink" href="#capa-de-presentacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El servicio de la universidad será implementado mediante <strong>controladores
de página</strong> (tal como se hizo en el tutorial anterior), en donde cada
página se implementa como un controlador individual. Igual que antes, la
clase general para definir los controladores se llama
<strong>PageController.java</strong> y debe residir en el directorio
<strong>/tutorial5/src/display/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

import org.springframework.web.context.*;
import org.springframework.web.context.support.*;

public class PageController extends HttpServlet {

  protected WebApplicationContext context;

  public void init(ServletConfig config) throws ServletException {
    super.init(config);
    context =
     WebApplicationContextUtils.getWebApplicationContext(
       getServletContext());
  }

   protected void forward(String target, HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
    RequestDispatcher dispatcher =
      context.getServletContext().getRequestDispatcher(target);
    dispatcher.forward(request,response);
  }
}
</pre></div>
</div>
<div class="section" id="el-controlador-de-listado-de-profesores">
<h3>6.2.1. El controlador de listado de profesores<a class="headerlink" href="#el-controlador-de-listado-de-profesores" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El primer controlador de página es el que permite mostrar el listado de
profesores. Este archivo se llama <strong>ListaProfesores.java</strong> y reside en
el mismo directorio <strong>/tutorial5/src/display/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;
import domain.ProfesorRepository;
import domain.Profesor;
import util.ProfesorDTO;
import util.ProfesorAssembler;

public class ListaProfesores extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
      ProfesorRepository profesores =
        (ProfesorRepository) context.getBean(&quot;profesorRepository&quot;);
    try {
        Collection lista = profesores.findAllProfesor();
        List data = new ArrayList();
        Iterator itr = lista.iterator();
        while (itr.hasNext()) {
            Profesor prof = (Profesor)itr.next();
            ProfesorDTO dto = ProfesorAssembler.CreateDTO(prof);
            data.add(dto);
        }
      request.setAttribute(&quot;profesores&quot;,data);
      forward(&quot;/listaProfesores.jsp&quot;,request,response);
    } catch (Exception e) {
        request.setAttribute(&quot;mensaje&quot;,e.getMessage());
        forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
<div class="section" id="la-plantilla-jsp">
<h4>6.2.1.1. La plantilla JSP<a class="headerlink" href="#la-plantilla-jsp" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Adicionalmente se utilizará, con en el tutorial anterior, una
<strong>plantilla</strong> JSP para realizar el formateo de página en código HTML. El
archivo <strong>listaProfesores.jsp</strong> se encarga de esta tarea y residirá en
el directorio <strong>/tutorial5/root/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ page import=&quot;java.util.*&quot; %&gt;
&lt;%@ page import=&quot;util.*&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Sistema Universitario&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
  &lt;/head&gt;
  &lt;h1&gt;Sistema Universitario&lt;/h1&gt;
  &lt;h2&gt;Listado de profesores&lt;/h2&gt;
  &lt;% List profs = (List)request.getAttribute(&quot;profesores&quot;); %&gt;
  &lt;table&gt;
     &lt;thead&gt;
    &lt;tr&gt;&lt;th&gt;Nombre&lt;/th&gt;&lt;th&gt;T&amp;iacute;tulo&lt;/th&gt;
        &lt;th&gt;Area&lt;/th&gt;&lt;th&gt;Acciones&lt;/th&gt;&lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;% for(int i = 0, n = profs.size(); i &lt; n; i++) {
         ProfesorDTO prof = (ProfesorDTO) profs.get(i); %&gt;
        &lt;tr&gt;&lt;td&gt;&lt;%= prof.getNombre() %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= prof.getTitulo() %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= prof.getArea() %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=&#39;/detalleProfesor?id=&lt;%= prof.getId() %&gt;&#39;&gt;
              &lt;input type=&quot;submit&quot; value=&quot;Detalle&quot;/&gt;&lt;/a&gt;
            &lt;a href=&#39;/eliminarProfesor?id=&lt;%= prof.getId() %&gt;&#39;&gt;
              &lt;input type=&quot;submit&quot; value=&quot;Eliminar&quot;/&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;% } %&gt;
  &lt;/tbody&gt;
    &lt;tfoot&gt;
      &lt;tr&gt;&lt;td&gt;&lt;a href=&#39;/agregarProfesor&#39;&gt;
        &lt;input type=&quot;submit&quot; name=&quot;action&quot; value=&quot;Agregar&quot;/&gt;&lt;/a&gt;
      &lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tfoot&gt;
  &lt;/table&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>Nótese que la tabla generada cuenta con enlaces que invocarán la rutina
que presenta el detalle del profesor (que se describe a continuación).</p>
</div>
<div class="section" id="hoja-de-estilo">
<h4>6.2.1.2. Hoja de estilo<a class="headerlink" href="#hoja-de-estilo" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Con el fin de mejorar la apariencia de este ejemplo se ha desarrollado
una pequeña hoja de estilo (css) que permite organizar mejor los datos
de la tabla y el formulario. El archivo llamado <em>style.css</em> cuenta con
el siguiente código y y reside en el directorio <em>/tutorial5/root/</em>.:</p>
<div class="highlight-python"><div class="highlight"><pre>body {
  line-height: 1.6em;
  font-family:&quot;Lucida Sans Unicode&quot;, &quot;Lucida Grande&quot;, Sans-Serif;
  color: #009;
}
table {
  font-size: 12px;
  margin: 45px;
  width: 480px;
  text-align: left;
  border-collapse: collapse;
}
th, tfoot td {
  font-size: 13px;
  font-weight: normal;
  padding: 8px;
  background: #b9c9fe;
  border-top: 4px solid #aabcfe;
  border-bottom: 1px solid #fff;
  color: #039;
  text-align: center;
}
td {
  padding: 8px;
  background: #e8edff;
  border-bottom: 1px solid #fff;
  color: #669;
  border-top: 1px solid transparent;
}
tr:hover td {
  background: #d0dafd;
  color: #339;
}
input[type=&quot;text&quot;] {
  width: 250px;
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-controlador-de-detalle-de-profesor">
<h3>6.2.2. El controlador de detalle de profesor<a class="headerlink" href="#el-controlador-de-detalle-de-profesor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El controlador de detalle de profesor presentará otra tabla HTML con la
información detallada del profesor. Este controlador es llamado
<strong>DetalleProfesor.java</strong> y se ubica en el mismo directorio
<strong>/tutorial5/src/display/</strong>. Es importante observar la utilización del
<strong>id</strong> del profesor para realizar la consulta al módulo de tabla.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;
import domain.ProfesorRepository;
import domain.Profesor;
import util.ProfesorDTO;
import util.ProfesorAssembler;

public class DetalleProfesor extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
      ProfesorRepository profesores =
        (ProfesorRepository) context.getBean(&quot;profesorRepository&quot;);
    try {
      String id = request.getParameter(&quot;id&quot;);
      int idProf = Integer.parseInt(id);
      Profesor prof = profesores.findProfesor(idProf);
      ProfesorDTO dto = ProfesorAssembler.CreateDTO(prof);
      request.setAttribute(&quot;profesor&quot;,dto);
      forward(&quot;/detalleProfesor.jsp&quot;,request,response);
    } catch (Exception e) {
      request.setAttribute(&quot;mensaje&quot;,e.getMessage());
      forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
<div class="section" id="plantilla-jsp">
<h4>6.2.2.1. Plantilla JSP<a class="headerlink" href="#plantilla-jsp" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La plantilla JSP que genera el código HTML del detalle del profesor, se
presenta a continuación. El código de la plantilla se define en un
archivo llamado <strong>detalleProfesor.jsp</strong> que reside también en el
directorio <strong>/tutorial5/root/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ page import=&quot;java.util.Map&quot; %&gt;
&lt;%@ page import=&quot;util.*&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;
          charset=UTF-8&quot;/&gt;
    &lt;title&gt;Sistema Universitario&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
  &lt;/head&gt;
  &lt;h1&gt;Sistema Universitario&lt;/h1&gt;
  &lt;h2&gt;Detalle de Profesor&lt;/h2&gt;
  &lt;% ProfesorDTO prof =
    (ProfesorDTO)request.getAttribute(&quot;profesor&quot;); %&gt;
  &lt;form name=&quot;ActualizarProfesor&quot;
        action=&quot;/actualizarProfesor&quot; method=&quot;get&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;%= prof.getId() %&gt;&quot;/&gt;
  &lt;table&gt;
    &lt;thead&gt;
      &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;Nombre:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;nombre&quot;
            value=&quot;&lt;%= prof.getNombre() %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;C&amp;eacute;dula:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot;
            name=&quot;cedula&quot; value=&quot;&lt;%= prof.getCedula() %&gt;&quot;/&gt;
            &lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;T&amp;iacute;tulo:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot;
            name=&quot;titulo&quot; value=&quot;&lt;%= prof.getTitulo() %&gt;&quot;/&gt;
            &lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;Area:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;area&quot;
            value=&quot;&lt;%= prof.getArea() %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;Tel&amp;eacute;fono:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot;
            name=&quot;telefono&quot; value=&quot;&lt;%= prof.getTelefono() %&gt;&quot;/&gt;
            &lt;/td&gt;&lt;/tr&gt;
    &lt;/tbody&gt;
    &lt;tfoot&gt;
    &lt;tr&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Actualizar&quot; /&gt;
        &lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tfoot&gt;
  &lt;/table&gt;
  &lt;/form&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-controlador-para-actualizar-informacion">
<h3>6.2.3. El controlador para actualizar información<a class="headerlink" href="#el-controlador-para-actualizar-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se presenta también el controlador de página que permite actualizar los
datos de un profesor. La lógica de este controlador se ubica en el
archivo <strong>ActualizarProfesor.java</strong> y reside en el directorio
<strong>/tutorial5/src/display/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;

import domain.ProfesorRepository;
import domain.Profesor;

import util.ProfesorDTO;
import util.ProfesorAssembler;

public class ActualizarProfesor extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
      ProfesorRepository profesores =
        (ProfesorRepository) context.getBean(&quot;profesorRepository&quot;);
    try {
        String id = request.getParameter(&quot;id&quot;);
        int idProf = Integer.parseInt(id);
        String cedula = request.getParameter(&quot;cedula&quot;);
        String nombre = request.getParameter(&quot;nombre&quot;);
        String titulo = request.getParameter(&quot;titulo&quot;);
        String area = request.getParameter(&quot;area&quot;);
        String telefono = request.getParameter(&quot;telefono&quot;);
        Profesor prof = profesores.findProfesor(idProf);
        try {
            if (cedula!=null) prof.setCedula(cedula);
            if (nombre!=null) prof.setNombre(nombre);
            if (titulo!=null) prof.setTitulo(titulo);
            if (area!=null) prof.setArea(area);
            if (telefono!=null) prof.setTelefono(telefono);
                profesores.updateProfesor(prof);
        } catch (Exception e) {}
        response.sendRedirect(&quot;listaProfesores&quot;);
    } catch (Exception e) {
        request.setAttribute(&quot;mensaje&quot;,e.getMessage());
        forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
<div class="section" id="plantilla-jsp-de-mensaje-de-error">
<h4>6.2.3.1. Plantilla JSP de mensaje de error<a class="headerlink" href="#plantilla-jsp-de-mensaje-de-error" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Se puede utilizar un archivo JSP adicional para desplegar los mensajes
de error. En particular este archivo será llamado <strong>paginaError.jsp</strong> y
residirá en el directorio <strong>/tutorial5/root/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;
    &lt;title&gt;Sistema Universitario&lt;/title&gt;
  &lt;/head&gt;
  &lt;% String mensaje = (String)request.getAttribute(&quot;mensaje&quot;); %&gt;
  &lt;h1&gt;Error en operaci&amp;oacute;n&lt;/h1&gt;
  &lt;p&gt;&lt;%= mensaje %&gt;&lt;/p&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-dto-de-profesor">
<h3>6.2.4. El DTO de profesor<a class="headerlink" href="#el-dto-de-profesor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En esta implementación también se utiliza una clase tipo DTO (Data
Transfer Object) que facilite el paso de información hacia las vistas de
datos. Para ello se utiliza la clase <strong>ProfesorDTO.java</strong> pero esta
clase residirá en el directorio <strong>/tutorial5/src/util/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>package util;

public class ProfesorDTO {
  private int id;
  private String cedula;
  private String nombre;
  private String titulo;
  private String area;
  private String telefono;

  public int getId() {return id;}
  public String getCedula() {return cedula;}
  public String getNombre() {return nombre;}
  public String getTitulo() {return titulo;}
  public String getArea() {return area;}
  public String getTelefono() {return telefono;}
  public void setId(int id) {this.id=id;}
  public void setCedula(String ced) {cedula=ced;}
  public void setNombre(String nom) {nombre=nom;}
  public void setTitulo(String tit) {titulo=tit;}
  public void setArea(String are) {area=are;}
  public void setTelefono(String tel) {telefono=tel;}
}
</pre></div>
</div>
<div class="section" id="el-ensamblador-del-dto">
<h4>6.2.4.1. El ensamblador del DTO<a class="headerlink" href="#el-ensamblador-del-dto" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Adicionalmente es necesario contar con una clase que realice el
ensamblaje del DTO a partir de la entidad de profesor. Aquí se utiliza
la clase <strong>ProfesorAssembler.java</strong> residente en el mismo directorio
<strong>/tutorial5/src/util/</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre>package util;
import domain.Profesor;

public class ProfesorAssembler {
  public static ProfesorDTO CreateDTO(Profesor prof) {
    ProfesorDTO dto = new ProfesorDTO();
    dto.setId(prof.getId());
    dto.setCedula(prof.getCedula());
    dto.setNombre(prof.getNombre());
    dto.setTitulo(prof.getTitulo());
    dto.setArea(prof.getArea());
    dto.setTelefono(prof.getTelefono());
    return dto;
  }
  public static void Update(Profesor prof, ProfesorDTO dto) {
    try {
      prof.setId(dto.getId());
      prof.setCedula(dto.getCedula());
      prof.setNombre(dto.getNombre());
      prof.setTitulo(dto.getTitulo());
      prof.setArea(dto.getArea());
      prof.setTelefono(dto.getTelefono());
    } catch (Exception e) {
    }
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="compilando-la-capa-de-presentacion">
<h3>6.2.5. Compilando la capa de presentación<a class="headerlink" href="#compilando-la-capa-de-presentacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para compilar la capa de presentación es necesario contar con las
librerías del framework <strong>Spring 3</strong> (como se indicó antes) y con la
librería <strong>servlet-api.jar</strong> ubicadas en el directorio
<strong>/tutorial5/root/WEB-INF/lib/</strong>.</p>
<p>Específicamente las librerías necesarias son las siguientes:</p>
<ul class="simple">
<li>servlet-api.jar</li>
<li>spring-asm-3.2.0.M1.jar</li>
<li>spring-beans-3.2.0.M1.jar</li>
<li>spring-context-3.2.0.M1.jar</li>
<li>spring-core-3.2.0.M1.jar</li>
<li>spring-expression-3.2.0.M1.jar</li>
<li>spring-jdbc-3.2.0.M1.jar</li>
<li>spring-orm-3.2.0.M1.jar</li>
<li>spring-tx.3.2.0.M1.jar</li>
<li>spring-web-3.2.0.M1.jar</li>
</ul>
<p>La siguiente instrucción para ejecutar la compilación puede estar
definida en un archivo <strong>compileDisplayLayer.bat</strong> residente en el
directorio <strong>/tutorial5/</strong> (todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
  -d root/WEB-INF/classes src/display/PageController.java
  src/display/ActualizarProfesor.java src/display/DetalleProfesor.java
  src/display/ListaProfesores.java src/util/ProfesorAssembler.java
  src/util/ProfesorDTO.java
</pre></div>
</div>
</div>
</div>
<div class="section" id="capa-de-acceso-a-datos">
<h2>6.3. Capa de acceso a datos<a class="headerlink" href="#capa-de-acceso-a-datos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para la capa de acceso a datos se utilizará el patrón de <strong>mapeador de
datos</strong>. Para ello se requiere las librerías <strong>Spring</strong> e <strong>Hibernate</strong>.
En forma conjunta estas dos librerías facilitan el desarrollo de este
tipo de aplicaciones.</p>
<p>Un DAO (Data Access Object) debe incluir todo el código para realizar la
conexión con la base de datos y ejecutar las instrucciones SQL de
consulta y/o actualización de datos. Generalmente escribir todo este
código desde el principio resulta muy tedioso. Es por eso que Spring
provee la clase <strong>HibernateDaoSupport</strong> que facilita en gran medida la
escritura de clases tipo DAO.</p>
<div class="section" id="el-dao-de-profesor">
<h3>6.3.1. El DAO de profesor<a class="headerlink" href="#el-dao-de-profesor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para empezar se definirá la clase <strong>ProfesorDAO.java</strong> que residirá en
el directorio <strong>/src/data</strong>. Esta clase define el conjunto de
operaciones que se llevan a cabo sobre la base de datos y mediante
Hibernate. El contenido de dicho archivo sería el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>package data;
import java.util.Collection;
import util.ProfesorDTO;
import util.ProfesorAssembler;
import org.springframework.orm.hibernate3.support.HibernateDaoSupport;

public class ProfesorDAO extends HibernateDaoSupport {
 public boolean insert(ProfesorDTO profDTO) {
   getHibernateTemplate().saveOrUpdate(profDTO);
   return true;
 }
 public boolean delete(ProfesorDTO profDTO) {
   getHibernateTemplate().delete(profDTO);
   return true;
 }
 public ProfesorDTO findById(int id) {
   ProfesorDTO prof;
   prof = (ProfesorDTO)getHibernateTemplate().get(
           ProfesorDTO.class,new Integer(id));
   return prof;
 }
 public boolean update(ProfesorDTO profDTO) {
   getHibernateTemplate().saveOrUpdate(profDTO);
   return true;
 }
 public Collection findAll() {
   return getHibernateTemplate().find(&quot;from ProfesorDTO&quot;);
 }
}
</pre></div>
</div>
<p>Como se puede observar aquí también se utiliza el DTO del profesor pero
en esta ocasión es para pasar los datos desde objetos del dominio a la
capa de datos.</p>
<div class="section" id="repositorio-basado-en-dao">
<h4>6.3.1.1. Repositorio basado en DAO<a class="headerlink" href="#repositorio-basado-en-dao" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Ahora es necesario asociar esta clase tipo DAO con el modelo del dominio
de la capa de presentación. Este trabajo lo lleva a cabo la clase
<strong>ProfesorRepositoryDAOImpl.java</strong>, que es una clase equivalente a la
utiliza en el modelo del dominio. Esta clase también reside en el
directorio <strong>/src/data</strong> y su contenido sería:</p>
<div class="highlight-python"><div class="highlight"><pre>package data;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.ArrayList;
import domain.ProfesorRepository;
import util.ProfesorDTO;
import util.ProfesorAssembler;
import domain.Profesor;

public class ProfesorRepositoryDAOImpl
       implements ProfesorRepository {
 private ProfesorDAO profDAO;
 ProfesorRepositoryDAOImpl(ProfesorDAO profDAO) {
   this.profDAO = profDAO;
 }
 public boolean insertProfesor(Profesor prof) {
   ProfesorDTO profDTO = ProfesorAssembler.CreateDTO(prof);
   return (profDAO.insert(profDTO));
 }
 public boolean deleteProfesor(Profesor prof) {
   ProfesorDTO profDTO = ProfesorAssembler.CreateDTO(prof);
   return (profDAO.delete(profDTO));
 }
 public Profesor findProfesor(int id) {
   ProfesorDTO profDTO = profDAO.findById(id);
   if (profDTO!=null) {
     Profesor prof = new Profesor();
     System.out.println(profDTO.getNombre());
     ProfesorAssembler.Update(prof,profDTO);
     return prof;
   }
   return null;
 }
 public boolean updateProfesor(Profesor prof) {
   ProfesorDTO profDTO = ProfesorAssembler.CreateDTO(prof);
   return (profDAO.update(profDTO));
 }
 public Collection findAllProfesor() {
   Collection profsDTO = profDAO.findAll();
   List profList = new ArrayList();
   Iterator itr = profsDTO.iterator();
   while (itr.hasNext()) {
     Profesor prof = new Profesor();
     ProfesorDTO profDTO = (ProfesorDTO)itr.next();
     ProfesorAssembler.Update(prof,profDTO);
     profList.add(prof);
   }
   return profList;
 }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="base-de-datos">
<h3>6.3.2. Base de datos<a class="headerlink" href="#base-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se utilizará la misma base de datos SQLite del tutorial anterior para
administrar los datos. Dicha base de datos debe llevar por nombre
<strong>universidad.sqlite</strong> y debe estar ubicada en el directorio
<strong>/tutorial5/root/database/</strong>. El código SQL utilizado para generar la
tabla de profesores sería el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE profesor (id INTEGER PRIMARY KEY, cedula VARCHAR,
   nombre VARCHAR, titulo VARCHAR, area VARCHAR, telefono VARCHAR);
INSERT INTO profesor VALUES(1,&#39;101110111&#39;,&#39;Carlos Perez&#39;,
  &#39;Licenciado&#39;,&#39;Administracion&#39;,&#39;3456-7890&#39;);
INSERT INTO profesor VALUES(2,&#39;202220222&#39;,&#39;Luis Torres&#39;,
                     &#39;Master&#39;,&#39;Economia&#39;,&#39;6677-3456&#39;);
INSERT INTO profesor VALUES(3,&#39;303330333&#39;,&#39;Juan Castro&#39;,
  &#39;Licenciado&#39;,&#39;Matematica&#39;,&#39;6755-7788&#39;);
</pre></div>
</div>
<p>Para administrar una base de datos SQLite se puede utilizar alguno de
los excelentes productos creados para ello, tal como <strong>SQLiteman</strong> ó el
plugin para Firefox llamado <strong>SQLite Manager</strong></p>
</div>
<div class="section" id="compilando-la-capa-de-datos">
<h3>6.3.3. Compilando la capa de datos<a class="headerlink" href="#compilando-la-capa-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La compilación de la capa de datos también requiere las librerías de
<strong>Spring 3</strong>.</p>
<p>La siguiente instrucción para ejecutar la compilación puede estar
definida en un archivo <strong>compileDataLayer.bat</strong> residente en el
directorio <strong>/tutorial5</strong> (todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
  -d root/WEB-INF/classes src/data/ProfesorRepositoryDAOImpl.java
   src/data/ProfesorDAO.java
</pre></div>
</div>
<p>Nota: La versión del JDK debe ser superior a 6.0</p>
</div>
<div class="section" id="dialecto-sqlite">
<h3>6.3.4. Dialecto SQLite<a class="headerlink" href="#dialecto-sqlite" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para que <strong>Hibernate</strong> reconozca cualquier base de datos es necesario
contar con un archivo de <strong>dialecto</strong> que le identifique a <strong>Hibernate</strong>
algunas características importantes del motor de bases de datos.
Extrañamente, la versión actual de <strong>Hibernate</strong> no cuenta con dicho
archivo de dialecto para SQLite. Sin embargo, resulta sencillo escribir
dicho archivo directamente.</p>
<p>A continuación se presenta el archivo <strong>SQLDialect.java</strong>, que reside en
el directorio <strong>tutorial5/src/dialect</strong>, y cuyo contenido es:</p>
<div class="highlight-python"><div class="highlight"><pre>package dialect;
import java.sql.Types;
import org.hibernate.dialect.Dialect;
import org.hibernate.dialect.function.StandardSQLFunction;
import org.hibernate.dialect.function.SQLFunctionTemplate;
import org.hibernate.dialect.function.VarArgsSQLFunction;
import org.hibernate.type.StandardBasicTypes;

public class SQLiteDialect extends Dialect {
    public SQLiteDialect() {
        super();
        registerColumnType(Types.BIT, &quot;integer&quot;);
        registerColumnType(Types.TINYINT, &quot;tinyint&quot;);
        registerColumnType(Types.SMALLINT, &quot;smallint&quot;);
        registerColumnType(Types.INTEGER, &quot;integer&quot;);
        registerColumnType(Types.BIGINT, &quot;bigint&quot;);
        registerColumnType(Types.FLOAT, &quot;float&quot;);
        registerColumnType(Types.REAL, &quot;real&quot;);
        registerColumnType(Types.DOUBLE, &quot;double&quot;);
        registerColumnType(Types.NUMERIC, &quot;numeric&quot;);
        registerColumnType(Types.DECIMAL, &quot;decimal&quot;);
        registerColumnType(Types.CHAR, &quot;char&quot;);
        registerColumnType(Types.VARCHAR, &quot;varchar&quot;);
        registerColumnType(Types.LONGVARCHAR, &quot;longvarchar&quot;);
        registerColumnType(Types.DATE, &quot;date&quot;);
        registerColumnType(Types.TIME, &quot;time&quot;);
        registerColumnType(Types.TIMESTAMP, &quot;timestamp&quot;);
        registerColumnType(Types.BINARY, &quot;blob&quot;);
        registerColumnType(Types.VARBINARY, &quot;blob&quot;);
        registerColumnType(Types.LONGVARBINARY, &quot;blob&quot;);
        // registerColumnType(Types.NULL, &quot;null&quot;);
        registerColumnType(Types.BLOB, &quot;blob&quot;);
        registerColumnType(Types.CLOB, &quot;clob&quot;);
        registerColumnType(Types.BOOLEAN, &quot;integer&quot;);

        registerFunction(&quot;concat&quot;,
           new VarArgsSQLFunction(StandardBasicTypes.STRING, &quot;&quot;,
                &quot;||&quot;, &quot;&quot;));
        registerFunction(&quot;mod&quot;,
          new SQLFunctionTemplate(StandardBasicTypes.INTEGER,
                &quot;?1 % ?2&quot;));
        registerFunction(&quot;substr&quot;,
          new StandardSQLFunction(&quot;substr&quot;,
                StandardBasicTypes.STRING));
        registerFunction(&quot;substring&quot;,
          new StandardSQLFunction(&quot;substr&quot;,
                StandardBasicTypes.STRING));
    }
    public boolean supportsIdentityColumns() {return true;}
    public boolean hasDataTypeInIdentityColumn() {return false;}
    public String getIdentityColumnString() {return &quot;integer&quot;;}
    public String getIdentitySelectString() {
        return &quot;select last_insert_rowid()&quot;;
    }
    public boolean supportsLimit() {return true;}
    public String getLimitString(String query, boolean hasOffset) {
        return new StringBuffer(query.length() + 20).append(query).append(
                hasOffset ? &quot; limit ? offset ?&quot; : &quot; limit ?&quot;).toString();
    }
    public boolean supportsTemporaryTables() {return true;}
    public String getCreateTemporaryTableString() {
        return &quot;create temporary table if not exists&quot;;
    }
    public boolean dropTemporaryTableAfterUse() {return false;}
    public boolean supportsCurrentTimestampSelection() {return true;}
    public boolean isCurrentTimestampSelectStringCallable() {return false;}
    public String getCurrentTimestampSelectString() {
        return &quot;select current_timestamp&quot;;
    }
    public boolean supportsUnionAll() {return true;}
    public boolean hasAlterTable() {return false;}
    public boolean dropConstraints() {return false;}
    public String getAddColumnString() {
        return &quot;add column&quot;;
    }
    public String getForUpdateString() {return &quot;&quot;;}
    public boolean supportsOuterJoinForUpdate() {return false;}
    public String getDropForeignKeyString() {
        throw new UnsupportedOperationException(
                &quot;No drop foreign key syntax supported by SQLiteDialect&quot;);
    }
    public String getAddForeignKeyConstraintString(String constraintName,
            String[] foreignKey, String referencedTable, String[] primaryKey,
            boolean referencesPrimaryKey) {
        throw new UnsupportedOperationException(
                &quot;No add foreign key syntax supported by SQLiteDialect&quot;);
    }
    public String getAddPrimaryKeyConstraintString(String constraintName) {
        throw new UnsupportedOperationException(
                &quot;No add primary key syntax supported by SQLiteDialect&quot;);
    }
    public boolean supportsIfExistsBeforeTableName() {return true;}
    public boolean supportsCascadeDelete() {return false;}
}
</pre></div>
</div>
</div>
<div class="section" id="compilando-el-dialecto">
<h3>6.3.5. Compilando el dialecto<a class="headerlink" href="#compilando-el-dialecto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para compilar el dialecto de <strong>SQLite</strong> se puede ejecutar el archivo
<strong>compileDialect.bat</strong> desde el directorio <strong>tutorial5</strong>, y con el
siguiente contenido:</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
-d root/WEB-INF/classes src/dialect/SQLiteDialect.java
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuracion-de-la-aplicacion">
<h2>6.4. Configuración de la aplicación<a class="headerlink" href="#configuracion-de-la-aplicacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Este ejemplo se puede ejecutar bajo cualquier contenedor de Servlet. Por
ejemplo, para realizar la ejecución de pruebas se puede utilizar un
producto como el <strong>Winstone Servlet Container</strong> que permite ejecutar
servlets de forma muy sencilla. Se debe descargar el programa
<strong>winstone-0.9.10.jar</strong> y copiarlo en el directorio <strong>/tutorial5/</strong>. Sin
embargo (como antes), para lograr que <strong>Winstone</strong> ejecute plantillas
<strong>JSP</strong> es necesario descargar algunas librerías adicionales que deben
ser copiadas en el directorio <strong>/tutorial5/lib</strong>:</p>
<ul class="simple">
<li>el-api-6.0.18.jar</li>
<li>jasper-6.0.18.jar</li>
<li>jasper-el-6.0.18.jar</li>
<li>jasper-jdt-6.0.18.jar</li>
<li>jsp-api-6.0.18.jar</li>
<li>jstl-api-1.2.jar</li>
<li>jstl-impl-1.2.jar</li>
<li>jtds-1.2.4.jar</li>
<li>juli-6.0.18.jar</li>
<li>servlet-api-2.5.jar</li>
<li>servlet-api.jar</li>
</ul>
<p>Adicionalmente es necesario que en el directorio
<strong>tutorial5/root/WEB-INF/lib</strong> se encuentren las librerías que conforman
el paquete <strong>Hibernate</strong> y todas sus dependencias que básicamente son:</p>
<ul class="simple">
<li>antlr.jar</li>
<li>asm-attrs.jar</li>
<li>asm.jar</li>
<li>c3p0-0.9.0.jar</li>
<li>cglib-2.1.3.jar</li>
<li>commons-collections-3.1.jar</li>
<li>commons-dbcp-1.4.jar</li>
<li>commons-logging-1.1.1.jar</li>
<li>commons-pool-1.6.jar</li>
<li>dom4j-1.6.1.jar</li>
<li>hibernate-jpa-2.0-api-1.0.1.Final.jar</li>
<li>hibernate3.jar</li>
<li>javassist-3.12.0.GA.jar</li>
<li>jta-1.1.jar</li>
<li>slf4j-api-1.6.1.jar</li>
<li>sqlite-jdbc-3.6.0.jar</li>
</ul>
<div class="section" id="archivo-de-contexto">
<h3>6.4.1. Archivo de contexto<a class="headerlink" href="#archivo-de-contexto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Es necesario crear un archivo de contexto en donde se realizará la
creación de una serie de objetos necesarios. Este archivo lleva por
nombre <strong>context.xml</strong> y residirá en el directorio
<strong>tutorial5/root/WEB-INF</strong> y su contenido sería:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
  xsi:schemaLocation=&quot;
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;
  &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;
        destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClassName}&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;sessionFactory&quot;
      class=&quot;org.springframework.orm.hibernate3.LocalSessionFactoryBean&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
        &lt;property name=&quot;configurationClass&quot;
            value=&quot;org.hibernate.cfg.AnnotationConfiguration&quot;/&gt;
            &lt;property name=&quot;configLocation&quot;&gt;
            &lt;value&gt;classpath:hibernate.cfg.xml&lt;/value&gt;
        &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;transactionManager&quot;
      class=&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;&gt;
      &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;profesorDAO&quot; class=&quot;data.ProfesorDAO&quot;&gt;
    &lt;property name=&quot;sessionFactory&quot;&gt;&lt;ref local=&quot;sessionFactory&quot;/&gt;&lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;profesorRepository&quot; class=&quot;data.ProfesorRepositoryDAOImpl&quot;&gt;
    &lt;constructor-arg&gt;
      &lt;ref bean=&quot;profesorDAO&quot;/&gt;
    &lt;/constructor-arg&gt;
  &lt;/bean&gt;
  &lt;context:property-placeholder location=&quot;WEB-INF/jdbc.properties&quot;/&gt;
&lt;/beans&gt;
</pre></div>
</div>
<p>También es necesario el archivo <strong>jdbc.properties</strong> que reside en el
mismo directorio <strong>tutorial5/root/WEB-INF</strong> y cuyo contenido es:</p>
<div class="highlight-python"><div class="highlight"><pre>jdbc.driverClassName=org.sqlite.JDBC
jdbc.url=jdbc:sqlite:root/database/universidad.sqlite
jdbc.username=sa
jdbc.password=root
</pre></div>
</div>
</div>
<div class="section" id="archivo-de-configuracion-de-hibernate">
<h3>6.4.2. Archivo de configuración de Hibernate<a class="headerlink" href="#archivo-de-configuracion-de-hibernate" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong>Hibernate 3</strong> requiere de su propio archivo de configuración el cual
se llamará <strong>hibernate.cfg.xml</strong> y residirá en el directorio
<strong>/tutorial5/root/WEB-INF/classes</strong> y su contenido es:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
    &quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;
    &quot;http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&quot;&gt;
&lt;hibernate-configuration&gt;
    &lt;session-factory&gt;
        &lt;property name=&quot;show_sql&quot;&gt;true&lt;/property&gt;
        &lt;property name=&quot;format_sql&quot;&gt;true&lt;/property&gt;
        &lt;property name=&quot;dialect&quot;&gt;dialect.SQLiteDialect&lt;/property&gt;
        &lt;mapping resource=&quot;ProfesorDTO.hbm.xml&quot;/&gt;
    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;
</pre></div>
</div>
<div class="section" id="metadatos-para-la-clase-profesor">
<h4>6.4.2.1. Metadatos para la clase Profesor<a class="headerlink" href="#metadatos-para-la-clase-profesor" title="Enlazar permanentemente con este título">¶</a></h4>
<p><strong>Hibernate 3</strong> utiliza archivos de metadatos para establecer la
relación entre los campos de cada tabla y los atributos de las clases.
En este caso se utilizará un archivo llamado <strong>ProfesorDTO.hbm.xml</strong> que
residirá en el mismo directorio <strong>tutorial5/root/WEB-INF/classes</strong> y
cuyo contenido sería:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC &quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;
&quot;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&quot;&gt;
&lt;hibernate-mapping&gt;
&lt;class name=&quot;util.ProfesorDTO&quot; table=&quot;profesor&quot;&gt;
    &lt;id name=&quot;id&quot; column=&quot;id&quot; type=&quot;int&quot;&gt;
        &lt;generator class=&quot;native&quot;&gt;&lt;/generator&gt;
    &lt;/id&gt;
    &lt;property name=&quot;cedula&quot; column=&quot;cedula&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;nombre&quot; column=&quot;nombre&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;titulo&quot; column=&quot;titulo&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;area&quot; column=&quot;area&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;telefono&quot; column=&quot;telefono&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
&lt;/class&gt;
&lt;/hibernate-mapping&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-archivo-de-configuracion-de-servlets">
<h3>6.4.3. El archivo de configuración de servlets<a class="headerlink" href="#el-archivo-de-configuracion-de-servlets" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Por último, es necesario crear el archivo de definición de servlets para
esta aplicación. Como es costumbre su nombre será <strong>web.xml</strong>, su
ubicación será <strong>tutorial5/root/WEB-INF</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee
                       http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;
   version=&quot;2.4&quot;&gt;
 &lt;display-name&gt;Sistema Universitario&lt;/display-name&gt;
 &lt;description&gt;Ejemplo de Mapeo Relacional/Objeto/description&gt;
 &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;/WEB-INF/context.xml&lt;/param-value&gt;
 &lt;/context-param&gt;
 &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
 &lt;/listener&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;ActualizarProfesor&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.ActualizarProfesor&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;DetalleProfesor&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.DetalleProfesor&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;ListaProfesores&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.ListaProfesores&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;ActualizarProfesor&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/actualizarProfesor&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;DetalleProfesor&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/detalleProfesor&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;ListaProfesores&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/listaProfesores&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre></div>
</div>
</div>
<div class="section" id="ejecucion-del-tutorial">
<h3>6.4.4. Ejecución del Tutorial<a class="headerlink" href="#ejecucion-del-tutorial" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para ejecutar el servidor de servlets se puede crear un archivo de
instrucciones, llamado <strong>run.bat</strong> (todo en una sola línea), similar al
siguiente en el directorio <strong>/tutorial5/</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>java -jar winstone-0.9.10.jar --httpPort=8089
     --commonLibFolder=lib --useJasper=true --webroot=root
</pre></div>
</div>
<p>Luego se puede acceder a la aplicación desde cualquier visualizador web
y apuntando a la dirección <a class="reference external" href="http://localhost:8089/listaProfesores">http://localhost:8089/listaProfesores</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">6. Mapeo objeto/relacional</a><ul>
<li><a class="reference internal" href="#capa-de-logica-del-dominio">6.1. Capa de lógica del dominio</a><ul>
<li><a class="reference internal" href="#el-repositorio-de-datos">6.1.1. El repositorio de datos</a></li>
<li><a class="reference internal" href="#la-fabrica-de-objetos">6.1.2. La fábrica de objetos</a></li>
<li><a class="reference internal" href="#compilando-la-capa-del-dominio">6.1.3. Compilando la capa del dominio</a></li>
</ul>
</li>
<li><a class="reference internal" href="#capa-de-presentacion">6.2. Capa de presentación</a><ul>
<li><a class="reference internal" href="#el-controlador-de-listado-de-profesores">6.2.1. El controlador de listado de profesores</a><ul>
<li><a class="reference internal" href="#la-plantilla-jsp">6.2.1.1. La plantilla JSP</a></li>
<li><a class="reference internal" href="#hoja-de-estilo">6.2.1.2. Hoja de estilo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-controlador-de-detalle-de-profesor">6.2.2. El controlador de detalle de profesor</a><ul>
<li><a class="reference internal" href="#plantilla-jsp">6.2.2.1. Plantilla JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-controlador-para-actualizar-informacion">6.2.3. El controlador para actualizar información</a><ul>
<li><a class="reference internal" href="#plantilla-jsp-de-mensaje-de-error">6.2.3.1. Plantilla JSP de mensaje de error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-dto-de-profesor">6.2.4. El DTO de profesor</a><ul>
<li><a class="reference internal" href="#el-ensamblador-del-dto">6.2.4.1. El ensamblador del DTO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compilando-la-capa-de-presentacion">6.2.5. Compilando la capa de presentación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#capa-de-acceso-a-datos">6.3. Capa de acceso a datos</a><ul>
<li><a class="reference internal" href="#el-dao-de-profesor">6.3.1. El DAO de profesor</a><ul>
<li><a class="reference internal" href="#repositorio-basado-en-dao">6.3.1.1. Repositorio basado en DAO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#base-de-datos">6.3.2. Base de datos</a></li>
<li><a class="reference internal" href="#compilando-la-capa-de-datos">6.3.3. Compilando la capa de datos</a></li>
<li><a class="reference internal" href="#dialecto-sqlite">6.3.4. Dialecto SQLite</a></li>
<li><a class="reference internal" href="#compilando-el-dialecto">6.3.5. Compilando el dialecto</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuracion-de-la-aplicacion">6.4. Configuración de la aplicación</a><ul>
<li><a class="reference internal" href="#archivo-de-contexto">6.4.1. Archivo de contexto</a></li>
<li><a class="reference internal" href="#archivo-de-configuracion-de-hibernate">6.4.2. Archivo de configuración de Hibernate</a><ul>
<li><a class="reference internal" href="#metadatos-para-la-clase-profesor">6.4.2.1. Metadatos para la clase Profesor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-archivo-de-configuracion-de-servlets">6.4.3. El archivo de configuración de servlets</a></li>
<li><a class="reference internal" href="#ejecucion-del-tutorial">6.4.4. Ejecución del Tutorial</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="tutorial4.md.html"
                        title="capítulo anterior">4. Modelo del Dominio</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="tutorial6.md.html"
                        title="próximo capítulo">7. Uso de JSTL</a></p>
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Introduzca los términos de búsqueda o un nombre de módulo, clase o función.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial6.md.html" title="7. Uso de JSTL"
             >siguiente</a></li>
        <li class="right" >
          <a href="tutorial4.md.html" title="4. Modelo del Dominio"
             >anterior</a> |</li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Armando Arce.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>