<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8. Modelo/Vista/Controlador &mdash; Desarrollo con Java</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Desarrollo con Java" href="index.html" />
    <link rel="prev" title="7. Uso de JSTL" href="tutorial6.md.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial6.md.html" title="7. Uso de JSTL"
             accesskey="P">anterior</a></li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="modelo-vista-controlador">
<h1>8. Modelo/Vista/Controlador<a class="headerlink" href="#modelo-vista-controlador" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Spring provee muchas opciones para configurar una aplicación. La más
popular es usar archivos XML.</p>
<div class="section" id="capa-del-dominio">
<h2>8.1. Capa del dominio<a class="headerlink" href="#capa-del-dominio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Se utilizará una única clase para ilustrar el desarrollo de una
aplicación MVC. En este caso será la clase de <strong>Profesor.java</strong>. Esta
clase se ubica en el directorio <strong>src/domain</strong> y su código es el
siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>package universidad.domain;
import java.io.Serializable;
public class Profesor implements Serializable {
 private String nombProf;
 private String idProf;
 private String tituloProf;
 public String getNombProf() {return nombProf;}
 public void setNombProf(String n) {nombProf=n;}
 public String getIdProf() {return idProf;}
 public void setIdProf(String id) {idProf=id;}
 public String getTituloProf() {return tituloProf;}
 public void setTituloProf(String tit)  {tituloProf = tit;}
}
</pre></div>
</div>
</div>
<div class="section" id="capa-de-servicio">
<h2>8.2. Capa de servicio<a class="headerlink" href="#capa-de-servicio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Aquí se utilizará una clase sencilla, llamada
<strong>SimpleProfesorManager.java</strong>, para configurar la capa de servicio.
Adicionalmente se utilizará una interfaz, llamada
<strong>ProfesorManager.java</strong>, en donde se definirán los métodos utilizados
por dicha clase. El código de dicha interfaz se localiza en el
directorio <strong>src/service</strong> y es el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>package universidad.service;
import java.io.Serializable;
import java.util.List;

import universidad.domain.Profesor;
public interface ProfesorManager extends Serializable{
   public List&lt;Profesor&gt; getProfesores();
}
</pre></div>
</div>
<p>El código de la clase <strong>SimpleProfesorManager.java</strong> se muestra a
continuación y se ubica en el mismo directorio:</p>
<div class="highlight-python"><div class="highlight"><pre>package universidad.service;
import java.util.ArrayList;
import java.util.List;
import universidad.domain.Profesor;

public class SimpleProfesorManager implements ProfesorManager {
  private List&lt;Profesor&gt; profesores;
  public List&lt;Profesor&gt; getProfesores() {
    return profesores;
  }
  public void setProfesores(List&lt;Profesor&gt; profesores) {
    this.profesores = profesores;
  }
}
</pre></div>
</div>
</div>
<div class="section" id="el-controlador">
<h2>8.3. El controlador<a class="headerlink" href="#el-controlador" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La capa de presentación consta de dos componentes, el controlador y la
vista. El controlador consta de una sola clase, llamada
<strong>ProfesorController.java</strong>, que carga el modelo de datos e invoca a la
vista, llamada <strong>profesorView.jsp</strong>. El código se muestra a continuación
y se ubica en el directorio <strong>src/web</strong>.:</p>
<div class="highlight-python"><div class="highlight"><pre>package universidad.web;
import org.springframework.web.servlet.mvc.Controller;
import org.springframework.web.servlet.ModelAndView;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Map;
import java.util.HashMap;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import universidad.service.ProfesorManager;

public class ProfesorController implements Controller {
 protected final Log logger = LogFactory.getLog(getClass());
 private ProfesorManager ProfesorManager;

 public ModelAndView handleRequest(HttpServletRequest request,
   HttpServletResponse response)
   throws ServletException, IOException {

   String now = (new java.util.Date()).toString();
   logger.info(&quot;returning profesor view with &quot; + now);

   Map&lt;String, Object&gt; myModel = new HashMap&lt;String, Object&gt;();
   myModel.put(&quot;now&quot;, now);
   myModel.put(&quot;profesores&quot;, this.ProfesorManager.getProfesores());

   return new ModelAndView(&quot;profesorView&quot;, &quot;model&quot;, myModel);
 }

 public void setProfesorManager(ProfesorManager ProfesorManager) {
   this.ProfesorManager = ProfesorManager;
 }
}
</pre></div>
</div>
</div>
<div class="section" id="la-vista">
<h2>8.4. La vista<a class="headerlink" href="#la-vista" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El archivo que genera la vista se llama <strong>profesorView.jsp</strong> y consta de
varias etiquetas que permiten listar la información de profesores. El
código es el siguiente y este archivo se ubica en el directorio
<strong>war/WEB-INF/jsp</strong>.:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ include file=&quot;/WEB-INF/jsp/include.jsp&quot; %&gt;
&lt;html&gt;
 &lt;head&gt;&lt;title&gt;&lt;fmt:message key=&quot;title&quot;/&gt;&lt;/title&gt;&lt;/head&gt;
 &lt;body&gt;
   &lt;h1&gt;&lt;fmt:message key=&quot;heading&quot;/&gt;&lt;/h1&gt;
   &lt;p&gt;&lt;fmt:message key=&quot;mensaje&quot;/&gt; &lt;c:out value=&quot;${model.now}&quot;/&gt;&lt;/p&gt;
   &lt;h3&gt;Profesores&lt;/h3&gt;
   &lt;table border=&quot;1&quot;&gt;
     &lt;tr&gt;&lt;th&gt;Nombre&lt;/th&gt;&lt;th&gt;Cedula&lt;/th&gt;&lt;th&gt;Titulo&lt;/th&gt;&lt;/tr&gt;
     &lt;c:forEach items=&quot;${model.profesores}&quot; var=&quot;prof&quot;&gt;
       &lt;tr&gt;&lt;td&gt;&lt;c:out value=&quot;${prof.nombProf}&quot;/&gt;&lt;/td&gt;
       &lt;td&gt;&lt;c:out value=&quot;${prof.idProf}&quot;/&gt;&lt;/td&gt;
       &lt;td&gt;&lt;c:out value=&quot;${prof.tituloProf}&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
     &lt;/c:forEach&gt;
   &lt;/table&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>Como se puede observar es necesario contar con el archivo
<strong>include.jsp</strong> que se ubica en el directorio <strong>war/WEB-INF/jsp</strong> y cuyo
código es simplemente el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ page session=&quot;false&quot;%&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;fmt&quot; uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; %&gt;
</pre></div>
</div>
<p>También existe un archivo que cuenta con algunos mensajes que se
despliegan en la página y se llama <strong>messages.properties</strong>. Este archivo
se ubica en el directorio <strong>war/WEB-INF/classes</strong> y su contenido es el
siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>title=Sistema Universitario
heading=Sistema Universitario - Inicio
mensaje=Bienvenido, la fecha actual es
</pre></div>
</div>
</div>
<div class="section" id="configuracion">
<h2>8.5. Configuración<a class="headerlink" href="#configuracion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para configurar la aplicación es necesario contar con un archivo
<strong>web.xml</strong> ubicado en el directorio <strong>war/WEB-INF</strong> con el siguiente
contenido.:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app version=&quot;2.4&quot;
        xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee
        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot; &gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;universidad&lt;/servlet-name&gt;
   &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet
   &lt;/servlet-class&gt;
   &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
 &lt;/servlet&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;universidad&lt;/servlet-name&gt;
   &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
 &lt;welcome-file-list&gt;
   &lt;welcome-file&gt;
     index.jsp
   &lt;/welcome-file&gt;
 &lt;/welcome-file-list&gt;
&lt;/web-app&gt;
</pre></div>
</div>
<p>También se utilizará otro archivo de configuración para crear objetos de
ejemplo que permitan probar la aplicación. Esto se hará utilizando el
archivo <strong>universidad-servlet.xml</strong> que se ubica en el mismo directorio
<strong>war/WEB-INF</strong>. Su contenido es el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
 xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
 http://www.springframework.org/schema/beans/spring-beans-2.5.xsd&quot;&gt;
 &lt;bean id=&quot;profesorManager&quot;
   class=&quot;universidad.service.SimpleProfesorManager&quot;&gt;
   &lt;property name=&quot;profesores&quot;&gt;
     &lt;list&gt;
       &lt;ref bean=&quot;profesor1&quot;/&gt;
       &lt;ref bean=&quot;profesor2&quot;/&gt;
       &lt;ref bean=&quot;profesor3&quot;/&gt;
     &lt;/list&gt;
   &lt;/property&gt;
 &lt;/bean&gt;
 &lt;bean id=&quot;profesor1&quot; class=&quot;universidad.domain.Profesor&quot;&gt;
   &lt;property name=&quot;nombProf&quot; value=&quot;Juan Jimenez&quot;/&gt;
   &lt;property name=&quot;idProf&quot; value=&quot;303450678&quot;/&gt;
   &lt;property name=&quot;tituloProf&quot; value=&quot;Licenciado&quot;/&gt;
 &lt;/bean&gt;
 &lt;bean id=&quot;profesor2&quot; class=&quot;universidad.domain.Profesor&quot;&gt;
   &lt;property name=&quot;nombProf&quot; value=&quot;Pedro Perez&quot;/&gt;
   &lt;property name=&quot;idProf&quot; value=&quot;102340567&quot;/&gt;
   &lt;property name=&quot;tituloProf&quot; value=&quot;Maestria&quot;/&gt;
 &lt;/bean&gt;
 &lt;bean id=&quot;profesor3&quot; class=&quot;universidad.domain.Profesor&quot;&gt;
   &lt;property name=&quot;nombProf&quot; value=&quot;Luisa Linares&quot;/&gt;
   &lt;property name=&quot;idProf&quot; value=&quot;407860887&quot;/&gt;
   &lt;property name=&quot;tituloProf&quot; value=&quot;Licenciada&quot;/&gt;
 &lt;/bean&gt;
 &lt;bean id=&quot;messageSource&quot;
   class=&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;&gt;
   &lt;property name=&quot;basename&quot; value=&quot;messages&quot;/&gt;
 &lt;/bean&gt;
 &lt;bean name=&quot;/hello.htm&quot; class=&quot;universidad.web.ProfesorController&quot;&gt;
   &lt;property name=&quot;profesorManager&quot; ref=&quot;profesorManager&quot;/&gt;
 &lt;/bean&gt;
 &lt;bean id=&quot;viewResolver&quot;
   class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
   &lt;property name=&quot;viewClass&quot;
             value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;
   &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
   &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
 &lt;/bean&gt;
&lt;/beans&gt;
</pre></div>
</div>
<p>Por último es necesario contar con un archivo inicial que reenvíe las
solicitudes que se realizan al sitio, este archivo se llama
<strong>index.jsp</strong> y se ubica en el directorio <strong>war</strong>. Su contenido es
simplemente:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ include file=&quot;/WEB-INF/jsp/include.jsp&quot; %&gt;
&lt;c:redirect url=&quot;/hello.htm&quot;/&gt;
</pre></div>
</div>
</div>
<div class="section" id="compilacion-y-ejecucion">
<h2>8.6. Compilación y ejecución<a class="headerlink" href="#compilacion-y-ejecucion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para compilar la aplicación es necesario copiar en el directorio
<strong>war/WEB-INF/lib</strong> las librerías <strong>spring.jar</strong> y <strong>spring-webmvc.jar</strong>
del framework Spring. También se requieren las librerías
<strong>servlet-api-2.5.jar</strong> y <strong>commons-logging-1.1.1.jar</strong> pero estas
pueden estar ubicados simplemente en el directorio <strong>lib</strong>.</p>
<p>Un script que permite compilar la aplicación tendría la siguiente forma
(todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -classpath lib/servlet-api-2.5.jar;lib/commons-logging-1.1.1.jar;
  war/WEB-INF/lib/spring-webmvc.jar -d war/WEB-INF/classes
  src/service/*.java src/domain/*.java src/web/*.java
</pre></div>
</div>
<p>Utilizando <strong>winstone</strong> se puede correr la aplicación utilizando
simplemente:</p>
<div class="highlight-python"><div class="highlight"><pre>java -jar winstone-0.9.10.jar --webroot=war --useJasper
</pre></div>
</div>
<p>luego basta con apuntar el navegador a la dirección:</p>
<p><a class="reference external" href="http://localhost:8080">http://localhost:8080</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">8. Modelo/Vista/Controlador</a><ul>
<li><a class="reference internal" href="#capa-del-dominio">8.1. Capa del dominio</a></li>
<li><a class="reference internal" href="#capa-de-servicio">8.2. Capa de servicio</a></li>
<li><a class="reference internal" href="#el-controlador">8.3. El controlador</a></li>
<li><a class="reference internal" href="#la-vista">8.4. La vista</a></li>
<li><a class="reference internal" href="#configuracion">8.5. Configuración</a></li>
<li><a class="reference internal" href="#compilacion-y-ejecucion">8.6. Compilación y ejecución</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="tutorial6.md.html"
                        title="capítulo anterior">7. Uso de JSTL</a></p>
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Introduzca los términos de búsqueda o un nombre de módulo, clase o función.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial6.md.html" title="7. Uso de JSTL"
             >anterior</a></li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Armando Arce.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>