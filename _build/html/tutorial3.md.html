<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Módulo de Tabla &mdash; Desarrollo con Java</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Desarrollo con Java" href="index.html" />
    <link rel="next" title="4. Modelo del Dominio" href="tutorial4.md.html" />
    <link rel="prev" title="2. Rutinas de Transacción" href="tutorial2.md.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial4.md.html" title="4. Modelo del Dominio"
             accesskey="N">siguiente</a></li>
        <li class="right" >
          <a href="tutorial2.md.html" title="2. Rutinas de Transacción"
             accesskey="P">anterior</a> |</li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="modulo-de-tabla">
<h1>3. Módulo de Tabla<a class="headerlink" href="#modulo-de-tabla" title="Enlazar permanentemente con este título">¶</a></h1>
<p>A continuación se presenta el mismo ejemplo del tutorial anterior de una
aplicación Web de un Sistema Universitario. En este ejemplo se
combinarán otros tres patrones descritos por Fowler: <em>módulo de tabla</em>
para la lógica del dominio, <em>pasarela a tabla de datos</em> para la capa de
acceso a los datos, y <em>controlador de página</em> para la capa de
presentación.</p>
<div class="section" id="capa-de-acceso-a-datos">
<h2>3.1. Capa de acceso a datos<a class="headerlink" href="#capa-de-acceso-a-datos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La capa de acceso a datos utilizará una <em>pasarela a tabla de datos</em> que
se conectará a una base de datos <em>SQLite</em>.</p>
<div class="section" id="base-de-datos">
<h3>3.1.1. Base de datos<a class="headerlink" href="#base-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se utilizará la misma base de datos SQLite del tutorial anterior para
administrar los datos. Dicha base de datos debe llevar por nombre
<em>universidad.db</em> y debe estar ubicada en el directorio
<em>/tutorial3/database/</em>. El código SQL utilizado para generar la tabla de
profesores sería el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE profesor (id INTEGER PRIMARY KEY, cedula VARCHAR,
  nombre VARCHAR, titulo VARCHAR, area VARCHAR, telefono VARCHAR);
INSERT INTO profesor VALUES(1,&#39;101110111&#39;,&#39;Carlos Perez&#39;,
  &#39;Licenciado&#39;,&#39;Administracion&#39;,&#39;3456-7890&#39;);
INSERT INTO profesor VALUES(2,&#39;202220222&#39;,&#39;Luis Torres&#39;,
  &#39;Master&#39;,&#39;Economia&#39;,&#39;6677-3456&#39;);
INSERT INTO profesor VALUES(3,&#39;303330333&#39;,&#39;Juan Castro&#39;,
  &#39;Licenciado&#39;,&#39;Matematica&#39;,&#39;6755-7788&#39;);
</pre></div>
</div>
<p>Para administrar una base de datos SQLite se puede utilizar alguno de
los excelentes productos creados para ello, tal como <em>SQLiteman</em> ó el
plugin para Firefox llamado <em>SQLite Manager</em></p>
</div>
<div class="section" id="pasarela-a-tabla-de-datos">
<h3>3.1.2. Pasarela a tabla de datos<a class="headerlink" href="#pasarela-a-tabla-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para implementar la capa de acceso de datos se utiliza una <em>pasarela a
tabla de datos</em>. Para ello es necesario crear una clase abstracta que se
encargue de almacenar la conexión jdbc. Esta clase se llamará
<em>TableGateway.java</em> y residirá en el directorio <em>/tutorial3/src/data/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package data;

import java.util.*;
import javax.sql.*;
import org.springframework.jdbc.core.JdbcTemplate;

public abstract class TableGateway {

  protected JdbcTemplate jdbcTemplate;

  public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
  }
}
</pre></div>
</div>
<p>La otra clase necesaria es la que implementa la tabla de datos para los
profesores. Este archivo se llama <em>ProfesorGateway.java</em> y reside en el
mismo directorio <em>/tutorial3/src/data/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package data;

import java.util.*;
import javax.sql.*;
import org.springframework.jdbc.core.JdbcTemplate;

public class ProfesorGateway extends TableGateway {

  private final static String findStatement =
     &quot;SELECT * &quot;+
     &quot;FROM profesor &quot;+
     &quot;WHERE id = ?&quot;;

  public Map&lt;String, Object&gt; find(String id) {
    List profs = jdbcTemplate.queryForList(findStatement,id);
    return (Map&lt;String, Object&gt;)profs.get(0);
  }

  private final static String findAllStatement =
     &quot;SELECT * &quot;+
     &quot;FROM profesor &quot;;

  public List&lt;Map&lt;String, Object&gt;&gt; findAll() {
    return jdbcTemplate.queryForList(findAllStatement);
  }

  private static final String insertStatement =
    &quot;INSERT INTO profesor &quot;+
  &quot;VALUES (?,?,?,?,?,?)&quot;;

  public int insert(String cedula,String nombre,String titulo,
    String area, String telefono) {
    Random generator = new Random();
    int id = generator.nextInt();
      jdbcTemplate.update(insertStatement,
         id,cedula,nombre,titulo,area,telefono);
    return id;
  }

  private static final String updateStatement =
    &quot;UPDATE profesor &quot;+
    &quot;SET cedula = ?, nombre = ?, titulo = ?, &quot;+
    &quot;area = ?, telefono = ? WHERE id = ?&quot;;

  public void update(int id,String cedula,String nombre,
    String titulo, String area, String telefono) {
      jdbcTemplate.update(updateStatement,
          cedula,nombre,titulo,area,telefono,id);
  }

  private static final String deleteStatement =
    &quot;DELETE FROM profesor &quot;+
    &quot;WHERE id = ?&quot;;

  public void delete(int id) {
      jdbcTemplate.update(deleteStatement,id);
  }
}
</pre></div>
</div>
</div>
<div class="section" id="compilando-la-capa-de-datos">
<h3>3.1.3. Compilando la capa de datos<a class="headerlink" href="#compilando-la-capa-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se puede realizar la compilación de estas dos clases en forma separada
del resto del código. Para ello es necesario contar con el framework
<em>Spring 3</em> el cual se debe descargar y copiar todas las librerías <em>.jar</em>
del directorio <em>lib</em> de dicho framework hacia el directorio
<em>/tutorial3/root/WEB-INF/lib/</em>. También es necesario contar en dicho
directorio con el driver jdbc para <em>SQLite</em> y las librerías <em>commons</em>
para manejo de conexiones a base de datos.</p>
<p>Específicamente las librerías que deben residir en el directorio
<em>/tutorial3/root/WEB-INF/lib/</em> son las siguientes:</p>
<ul class="simple">
<li>commons-dbcp-1.4.jar</li>
<li>commons-logging-1.1.1.jar</li>
<li>commons-pool-1.6.jar</li>
<li>servlet-api.jar</li>
<li>spring-asm-3.2.0.M1.jar</li>
<li>spring-beans-3.2.0.M1.jar</li>
<li>spring-context-3.2.0.M1.jar</li>
<li>spring-core-3.2.0.M1.jar</li>
<li>spring-expression-3.2.0.M1.jar</li>
<li>spring-jdbc-3.2.0.M1.jar</li>
<li>spring-tx.3.2.0.M1.jar</li>
<li>spring-web-3.2.0.M1.jar</li>
<li>sqlite-jdbc-3.5.9.jar</li>
</ul>
<p>La siguiente instrucción para ejecutar la compilación puede estar
definida en un archivo <em>compileData.bat</em> residente en el directorio
<em>/tutorial3</em> (todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
  -d root/WEB-INF/classes src/data/TableGateway.java
  src/data/ProfesorGateway.java
</pre></div>
</div>
<p>Nota: La versión del JDK debe ser superior a 6.0</p>
</div>
</div>
<div class="section" id="la-capa-de-logica-del-dominio">
<h2>3.2. La capa de lógica del dominio<a class="headerlink" href="#la-capa-de-logica-del-dominio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para implementar la capa de lógica del dominio se utilizará la técnica
de <em>módulo de tabla</em>. En este caso el módulo agrupa toda la lógica del
dominio, pero no se encarga del acceso a datos. Para acceder a los datos
se utiliza la <em>pasarela a tabla de datos</em> mostrada anteriormente.</p>
<p>La única clase necesaria sería la llamada <em>ProfesorModule.java</em> y
residirá en el directorio <em>/tutorial3/src/domain/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package domain;

import data.TableGateway;
import data.ProfesorGateway;

import java.util.Map;
import java.util.List;
import java.io.IOException;
import javax.servlet.ServletException;

public class ProfesorModule {

  private ProfesorGateway gateway;

  public void setGateway(TableGateway gateway) {
    this.gateway = (ProfesorGateway)gateway;
  }

  public void actualizar(int id, String cedula, String nombre,
    String titulo, String area, String telefono) throws Exception {
    if (id &lt;= 0)
      throw new Exception(&quot;Identificador de profesor incorrecto&quot;);
    if (titulo.toLowerCase().equals(&quot;bachiller&quot;) ||
        titulo.toLowerCase().equals(&quot;licenciado&quot;) ||
        titulo.toLowerCase().equals(&quot;master&quot;) ||
        titulo.toLowerCase().equals(&quot;doctor&quot;))
      gateway.update(id,cedula,nombre,titulo,area,telefono);
    else
      throw new Exception(&quot;Error en título de profesor&quot;);
  }

  public Map&lt;String,Object&gt; buscar(int id) throws Exception {
    if (id &lt;= 0)
      throw new Exception(&quot;Identificador de profesor incorrecto&quot;);
    Map&lt;String,Object&gt; prof = gateway.find(id+&quot;&quot;);
    return prof;
  }

  public List&lt;Map&lt;String,Object&gt;&gt; listado() throws Exception {
    List&lt;Map&lt;String,Object&gt;&gt; profs = gateway.findAll();
    return profs;
  }
}
</pre></div>
</div>
<div class="section" id="compilando-la-capa-de-dominio">
<h3>3.2.1. Compilando la capa de dominio<a class="headerlink" href="#compilando-la-capa-de-dominio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para compilar la clase del dominio es necesario contar con las librerías
del framework <em>Spring 3</em> (como se indicó antes). La siguiente
instrucción para ejecutar la compilación puede estar definida en un
archivo <em>compileDomain.bat</em> residente en el directorio <em>/tutorial3/</em>
(todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
  -d root/WEB-INF/classes src/domain/ProfesorModule.java
</pre></div>
</div>
</div>
</div>
<div class="section" id="capa-de-presentacion">
<h2>3.3. Capa de presentación<a class="headerlink" href="#capa-de-presentacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El servicio de la root ha sido implementado mediante <em>controladores de
página</em>, en donde cada página se implementa como un controlador
individual. La clase general para definir los controladores se llama
<em>PageController.java</em> y debe residir en el directorio
<em>/tutorial3/src/display/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

import org.springframework.web.context.*;
import org.springframework.web.context.support.*;

public class PageController extends HttpServlet {

  protected WebApplicationContext context;

  public void init(ServletConfig config) throws ServletException {
    super.init(config);
    context =
      WebApplicationContextUtils.getWebApplicationContext(getServletContext());
  }

   protected void forward(String target, HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
    RequestDispatcher dispatcher =
      context.getServletContext().getRequestDispatcher(target);
    dispatcher.forward(request,response);
  }
}
</pre></div>
</div>
<div class="section" id="el-controlador-de-listado-de-profesores">
<h3>3.3.1. El controlador de listado de profesores<a class="headerlink" href="#el-controlador-de-listado-de-profesores" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El primer controlador de página es el que permite mostrar el listado de
profesores. Este archivo se llama <em>ListaProfesores.java</em> y reside en el
mismo directorio <em>/tutorial3/src/display/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;

import domain.ProfesorModule;

public class ListaProfesores extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
    ProfesorModule module =
      (ProfesorModule) context.getBean(&quot;profesorModule&quot;);
    try {
      List data = module.listado();
      request.setAttribute(&quot;profesores&quot;,data);
      forward(&quot;/listaProfesores.jsp&quot;,request,response);
    } catch (Exception e) {
      request.setAttribute(&quot;mensaje&quot;,e.getMessage());
      forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
<div class="section" id="la-plantilla-jsp">
<h4>3.3.1.1. La plantilla JSP<a class="headerlink" href="#la-plantilla-jsp" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Adicionalmente se utilizará, con en el tutorial anterior, una
<em>plantilla</em> JSP para realizar el formateo de página en código HTML. El
archivo <em>listaProfesores.jsp</em> se encarga de esta tarea y residirá en el
directorio <em>/tutorial3/root/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;%@ page import=&quot;java.util.*&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Sistema Universitario&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;
          charset=UTF-8&quot; /&gt;
  &lt;/head&gt;
  &lt;h1&gt;Sistema Universitario&lt;/h1&gt;
  &lt;h2&gt;Listado de profesores&lt;/h2&gt;
  &lt;% List profs = (List)request.getAttribute(&quot;profesores&quot;); %&gt;
  &lt;table&gt;
    &lt;thead&gt;
    &lt;tr&gt;&lt;th&gt;Nombre&lt;/th&gt;&lt;th&gt;T&amp;iacute;tulo&lt;/th&gt;&lt;th&gt;Area&lt;/th&gt;
        &lt;th&gt;Acciones&lt;/th&gt;&lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;% for(int i = 0, n = profs.size(); i &lt; n; i++) {
         Map prof = (Map) profs.get(i); %&gt;
        &lt;tr&gt;&lt;td&gt;&lt;%= prof.get(&quot;nombre&quot;) %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= prof.get(&quot;titulo&quot;) %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= prof.get(&quot;area&quot;) %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=&#39;/detalleProfesor?id=&lt;%= prof.get(&quot;id&quot;) %&gt;&#39;&gt;
              &lt;input type=&quot;submit&quot; value=&quot;Detalle&quot;/&gt;&lt;/a&gt;
            &lt;a href=&#39;/eliminarProfesor?id=&lt;%= prof.get(&quot;id&quot;) %&gt;&#39;&gt;
              &lt;input type=&quot;submit&quot; value=&quot;Eliminar&quot;/&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;% } %&gt;
  &lt;/tbody&gt;
    &lt;tfoot&gt;
      &lt;tr&gt;&lt;td&gt;&lt;a href=&#39;/agregarProfesor&#39;&gt;
        &lt;input type=&quot;submit&quot; name=&quot;action&quot; value=&quot;Agregar&quot;/&gt;&lt;/a&gt;
      &lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tfoot&gt;
  &lt;/table&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>Nótese que la tabla generada cuenta con enlaces que invocarán la rutina
que presenta el detalle del profesor (que se describe a continuación).</p>
</div>
<div class="section" id="hoja-de-estilo">
<h4>3.3.1.2. Hoja de estilo<a class="headerlink" href="#hoja-de-estilo" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Con el fin de mejorar la apariencia de este ejemplo se ha desarrollado
una pequeña hoja de estilo (css) que permite organizar mejor los datos
de la tabla y el formulario. El archivo llamado <em>style.css</em> cuenta con
el siguiente código y y reside en el directorio <em>/tutorial3/root/</em>.:</p>
<div class="highlight-python"><div class="highlight"><pre>body {
  line-height: 1.6em;
  font-family:&quot;Lucida Sans Unicode&quot;, &quot;Lucida Grande&quot;, Sans-Serif;
  color: #009;
}
table {
  font-size: 12px;
  margin: 45px;
  width: 480px;
  text-align: left;
  border-collapse: collapse;
}
th, tfoot td {
  font-size: 13px;
  font-weight: normal;
  padding: 8px;
  background: #b9c9fe;
  border-top: 4px solid #aabcfe;
  border-bottom: 1px solid #fff;
  color: #039;
  text-align: center;
}
td {
  padding: 8px;
  background: #e8edff;
  border-bottom: 1px solid #fff;
  color: #669;
  border-top: 1px solid transparent;
}
tr:hover td {
  background: #d0dafd;
  color: #339;
}
input[type=&quot;text&quot;] {
  width: 250px;
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-controlador-de-detalle-de-profesor">
<h3>3.3.2. El controlador de detalle de profesor<a class="headerlink" href="#el-controlador-de-detalle-de-profesor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El controlador de detalle de profesor presentará otra tabla HTML con la
información detallada del profesor. Este controlador es llamado
<em>DetalleProfesor.java</em> y se ubica en el mismo directorio
<em>/tutorial3/src/display/</em>. Es importante observar la utilización del
<em>id</em> del profesor para realizar la consulta al módula de tabla.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;

import domain.ProfesorModule;

public class DetalleProfesor extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
    ProfesorModule module =
      (ProfesorModule) context.getBean(&quot;profesorModule&quot;);
    try {
      String id = request.getParameter(&quot;id&quot;);
      int idProf = Integer.parseInt(id);
      Map prof = module.buscar(idProf);
      request.setAttribute(&quot;profesor&quot;,prof);
      forward(&quot;/detalleProfesor.jsp&quot;,request,response);
    } catch (Exception e) {
      request.setAttribute(&quot;mensaje&quot;,e.getMessage());
      forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
<div class="section" id="plantilla-jsp">
<h4>3.3.2.1. Plantilla JSP<a class="headerlink" href="#plantilla-jsp" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La plantilla JSP que genera el código HTML del detalle del profesor, se
presenta a continuación. El código de la plantilla se define en un
archivo llamado <em>detalleProfesor.jsp</em> que reside también en el
directorio <em>/tutorial3/root/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;
    &lt;title&gt;Sistema Universitario&lt;/title&gt;
     &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
  &lt;/head&gt;
  &lt;h1&gt;Sistema Universitario&lt;/h1&gt;
  &lt;h2&gt;Detalle de Profesor&lt;/h2&gt;
  &lt;% Map prof = (Map)request.getAttribute(&quot;profesor&quot;); %&gt;
  &lt;form name=&quot;ActualizarProfesor&quot; action=&quot;/actualizarProfesor&quot; method=&quot;get&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;%= prof.get(&quot;id&quot;) %&gt;&quot;/&gt;
  &lt;table style=&quot;width:400px;&quot;&gt;
    &lt;thead&gt;
      &lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;Nombre:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;nombre&quot;
        value=&quot;&lt;%= prof.get(&quot;nombre&quot;) %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;C&amp;eacute;dula:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;cedula&quot;
        value=&quot;&lt;%= prof.get(&quot;cedula&quot;) %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;T&amp;iacute;tulo:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;titulo&quot;
        value=&quot;&lt;%= prof.get(&quot;titulo&quot;) %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;Area:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;area&quot;
        value=&quot;&lt;%= prof.get(&quot;area&quot;) %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;Tel&amp;eacute;fono:&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;telefono&quot;
        value=&quot;&lt;%= prof.get(&quot;telefono&quot;) %&gt;&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tbody&gt;
    &lt;tfoot&gt;
    &lt;tr&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Actualizar&quot; /&gt;
        &lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;/tfoot&gt;
  &lt;/table&gt;
  &lt;/form&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-controlador-para-actualizar-informacion">
<h3>3.3.3. El controlador para actualizar información<a class="headerlink" href="#el-controlador-para-actualizar-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se presenta también el controlador de página que permite actualizar los
datos de un profesor. La lógica de este controlador se ubica en el
archivo <em>ActualizarProfesor.java</em> y reside en el directorio
<em>/tutorial3/src/display/</em>.</p>
<div class="highlight-python"><div class="highlight"><pre>package display;
import java.util.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import org.springframework.web.context.*;

import domain.ProfesorModule;

public class ActualizarProfesor extends PageController {

  public void doGet(HttpServletRequest request,
                    HttpServletResponse response)
    throws ServletException, IOException {
    ProfesorModule module =
      (ProfesorModule) context.getBean(&quot;profesorModule&quot;);
    try {
      String id = request.getParameter(&quot;id&quot;);
      int idProf = Integer.parseInt(id);
      String cedula = request.getParameter(&quot;cedula&quot;);
      String nombre = request.getParameter(&quot;nombre&quot;);
      String titulo = request.getParameter(&quot;titulo&quot;);
      String area = request.getParameter(&quot;area&quot;);
      String telefono = request.getParameter(&quot;telefono&quot;);
      module.actualizar(idProf,cedula,nombre,titulo,area,telefono);
      response.sendRedirect(&quot;listaProfesores&quot;);
    } catch (Exception e) {
      request.setAttribute(&quot;mensaje&quot;,e.getMessage());
      forward(&quot;/paginaError.jsp&quot;,request,response);
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="compilando-la-capa-de-presentacion">
<h3>3.3.4. Compilando la capa de presentación<a class="headerlink" href="#compilando-la-capa-de-presentacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para compilar la capa de presentación es necesario contar con las
librerías del framework <em>Spring 3</em> (como se indicó antes) y con la
librería <em>servlet-api.jar</em> ubicadas en el directorio
<em>/tutorial3/root/WEB-INF/lib/</em>. La siguiente instrucción para ejecutar
la compilación puede estar definida en un archivo <em>compileDisplay.bat</em>
residente en el directorio <em>/tutorial3/</em> (todo en una sola línea):</p>
<div class="highlight-python"><div class="highlight"><pre>javac -cp &quot;root/WEB-INF/classes&quot;;&quot;root/WEB-INF/lib/*&quot;
  -d root/WEB-INF/classes src/display/PageController.java
  src/display/ListaProfesores.java src/display/ActualizarProfesor.java
  src/display/DetalleProfesor.java
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuracion-del-contexto">
<h2>3.4. Configuración del contexto<a class="headerlink" href="#configuracion-del-contexto" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El framework <em>Spring</em> permite crear archivos xml que definen la
configuración del contexto de ejecución de la aplicación. El archivo de
configuración llamado <em>context.xml</em> se deberá ubicar en el directorio
<em>/tutorial3/root/WEB-INF/</em> y contendrá la siguiente información.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;
    &lt;bean id=&quot;profesorGateway&quot; class=&quot;data.ProfesorGateway&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;/bean&gt;
     &lt;bean id=&quot;profesorModule&quot; class=&quot;domain.ProfesorModule&quot;&gt;
        &lt;property name=&quot;gateway&quot; ref=&quot;profesorGateway&quot;/&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;
       destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClassName}&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
    &lt;/bean&gt;
    &lt;context:property-placeholder location=&quot;WEB-INF/jdbc.properties&quot;/&gt;
&lt;/beans&gt;
</pre></div>
</div>
<p>Los aspectos importantes que se pueden observar en este archivo son la
declaración de una instancia (singleton) al constructor de pasarelas y
la declaración de la fuente de datos <em>JDBC</em>.</p>
<p>Precisamente para configurar la fuente de datos se utilizará un archivo
de propiedades llamado <em>jdbc.properties</em> y que residirá en el directorio
<em>/tutorial3/root/WEB-INF</em>. Su contenido es simplemente el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>jdbc.driverClassName=org.sqlite.JDBC
jdbc.url=jdbc:sqlite:database/universidad.db
jdbc.username=sa
jdbc.password=root
</pre></div>
</div>
<p>Sin embargo, note que una base de datos <em>SQLite</em> no requiere indicar el
usuario y su clave.</p>
</div>
<div class="section" id="configuracion-del-servidor">
<h2>3.5. Configuración del servidor<a class="headerlink" href="#configuracion-del-servidor" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El servidor de servlets requiere del archivo de configuración de la
aplicación para conocer en donde se ubica la clase a ejecutar. Además
este archivo permite indicar la ubicación y nombre del archivo de
contexto. Estos archivos de configuración del servlet siempre se llaman
<em>web.xml</em> y deben residir en el directorio <em>/tutorial3/root/WEB-INF/</em>.
Para este caso su contenido sería el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee
                       http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;
   version=&quot;2.4&quot;&gt;
 &lt;display-name&gt;Sistema Universitario&lt;/display-name&gt;
 &lt;description&gt;Ejemplo de Módulo de Tabla&lt;/description&gt;
 &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;/WEB-INF/context.xml&lt;/param-value&gt;
 &lt;/context-param&gt;
 &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
 &lt;/listener&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;ActualizarProfesor&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.ActualizarProfesor&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;DetalleProfesor&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.DetalleProfesor&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet&gt;
   &lt;servlet-name&gt;ListaProfesores&lt;/servlet-name&gt;
   &lt;servlet-class&gt;display.ListaProfesores&lt;/servlet-class&gt;
 &lt;/servlet&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;ActualizarProfesor&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/actualizarProfesor&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;DetalleProfesor&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/detalleProfesor&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
 &lt;servlet-mapping&gt;
   &lt;servlet-name&gt;ListaProfesores&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/listaProfesores&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre></div>
</div>
</div>
<div class="section" id="ejecucion-del-tutorial">
<h2>3.6. Ejecución del tutorial<a class="headerlink" href="#ejecucion-del-tutorial" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Este ejemplo se puede ejecutar bajo cualquier contenedor de Servlet. Por
ejemplo, para realizar la ejecución de pruebas se puede utilizar un
producto como el <em>Winstone Servlet Container</em> que permite ejecutar
servlets de forma muy sencilla. Se debe descargar el programa
<em>winstone-0.9.10.jar</em> y copiarlo en el directorio <em>/tutorial3/</em>. Sin
embargo, para lograr que <em>Winstone</em> ejecute plantillas <em>JSP</em> es
necesario descargar algunas librerías adicionales que deben ser copiadas
en el directorio <em>/tutorial3/lib</em>:</p>
<ul class="simple">
<li>el-api-6.0.18.jar</li>
<li>jasper-6.0.18.jar</li>
<li>jasper-el-6.0.18.jar</li>
<li>jasper-jdt-6.0.18.jar</li>
<li>jsp-api-6.0.18.jar</li>
<li>jstl-api-1.2.jar</li>
<li>jstl-impl-1.2.jar</li>
<li>jtds-1.2.4.jar</li>
<li>juli-6.0.18.jar</li>
<li>servlet-api-2.5.jar</li>
<li>servlet-api.jar</li>
<li>urlrewrite-3.2.0.jar</li>
</ul>
<p>Para ejecutar el servidor de servlets se puede crear un archivo de
instrucciones, llamado <em>run.bat</em>, similar al siguiente en el directorio
<em>/tutorial3/</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>java -jar winstone-0.9.10.jar --httpPort=8089 --commonLibFolder=lib
  --useJasper=true --webroot=root
</pre></div>
</div>
<p>Luego se puede acceder a la aplicación desde cualquier visualizador web
y apuntando a la dirección <a class="reference external" href="http://localhost:8089/listaProfesores">http://localhost:8089/listaProfesores</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Módulo de Tabla</a><ul>
<li><a class="reference internal" href="#capa-de-acceso-a-datos">3.1. Capa de acceso a datos</a><ul>
<li><a class="reference internal" href="#base-de-datos">3.1.1. Base de datos</a></li>
<li><a class="reference internal" href="#pasarela-a-tabla-de-datos">3.1.2. Pasarela a tabla de datos</a></li>
<li><a class="reference internal" href="#compilando-la-capa-de-datos">3.1.3. Compilando la capa de datos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#la-capa-de-logica-del-dominio">3.2. La capa de lógica del dominio</a><ul>
<li><a class="reference internal" href="#compilando-la-capa-de-dominio">3.2.1. Compilando la capa de dominio</a></li>
</ul>
</li>
<li><a class="reference internal" href="#capa-de-presentacion">3.3. Capa de presentación</a><ul>
<li><a class="reference internal" href="#el-controlador-de-listado-de-profesores">3.3.1. El controlador de listado de profesores</a><ul>
<li><a class="reference internal" href="#la-plantilla-jsp">3.3.1.1. La plantilla JSP</a></li>
<li><a class="reference internal" href="#hoja-de-estilo">3.3.1.2. Hoja de estilo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-controlador-de-detalle-de-profesor">3.3.2. El controlador de detalle de profesor</a><ul>
<li><a class="reference internal" href="#plantilla-jsp">3.3.2.1. Plantilla JSP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#el-controlador-para-actualizar-informacion">3.3.3. El controlador para actualizar información</a></li>
<li><a class="reference internal" href="#compilando-la-capa-de-presentacion">3.3.4. Compilando la capa de presentación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuracion-del-contexto">3.4. Configuración del contexto</a></li>
<li><a class="reference internal" href="#configuracion-del-servidor">3.5. Configuración del servidor</a></li>
<li><a class="reference internal" href="#ejecucion-del-tutorial">3.6. Ejecución del tutorial</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="tutorial2.md.html"
                        title="capítulo anterior">2. Rutinas de Transacción</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="tutorial4.md.html"
                        title="próximo capítulo">4. Modelo del Dominio</a></p>
<div id="searchbox" style="display: none">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Introduzca los términos de búsqueda o un nombre de módulo, clase o función.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="tutorial4.md.html" title="4. Modelo del Dominio"
             >siguiente</a></li>
        <li class="right" >
          <a href="tutorial2.md.html" title="2. Rutinas de Transacción"
             >anterior</a> |</li>
        <li><a href="index.html">Desarrollo con Java</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Armando Arce.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>